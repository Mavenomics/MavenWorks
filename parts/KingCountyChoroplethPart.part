{"typeName":"Part","id":"ccc54541-93a6-32dd-3a46-eb6fbe118214","name":"KingCountyChoropleth","path":"/Parts/KingCountyChoropleth","lastModified":"2018-09-11T18:51:09.764Z","data":{"htmlText":"<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js\"></script>","jsText":"this.render = function(args) {\n    const svg = d3.select(\"body svg\");\n\n    const table = args[0];\n    console.log(table);\n    \n    const low = d3.min(table.Rows, (row) => row[\"Price\"]);\n    const high = d3.max(table.Rows, (row) => row[\"Price\"]);\n\n    const scale = d3.scaleLinear()\n        .domain([low, high])\n        .range([\"#fee0d2\", \"#fc9272\", \"#de2d26\"]);\n\n    svg.selectAll(\"g.tract path\")\n        .attr(\"fill\", (d) => {\n            const row = table.Rows.findIndex(r => r[\"zip\"] === d.properties[\"ZIP\"]);\n            if (row === -1) {\n                return \"#ccc\";\n            }\n            return scale(table.Rows[row][\"Price\"]);\n        });\n};\n\nconst self = this;\n\nfunction setupChoropleth() {\n    $('body svg').empty().remove();\n    const svg = d3.select(\"body\").append(\"svg\")\n        .style(\"width\", \"600px\")\n        .style(\"height\", \"500px\")\n        .style(\"transform-origin\", \"0 0\");\n\n    function scaleSvg() {\n        const mapScale = Math.min((window.innerWidth) / 600, (window.innerHeight) / 500);\n        svg.style(\"transform\", `scale(${mapScale})`);\n    }\n\n    scaleSvg();\n\n    window.addEventListener(\"resize\", scaleSvg);\n\n    const path = d3.geoPath(d3.geoMercator()\n        .center([-121.5, 47.5])\n        .scale(25000));\n\n    const zipcodeFeature = window.shapefile\n        .objects['Zipcodes_for_King_County_and_Surrounding_Area__zipcode_area'];\n\n    let openHover;\n\n    svg.append(\"g\")\n        .classed(\"tract\", true)\n        .selectAll(\"path\")\n        .data(topojson.feature(window.shapefile, zipcodeFeature).features)\n        .enter()\n        .append(\"path\")\n        .attr(\"d\", path)\n        .on(\"mouseenter\", (d) => {\n            if (d.properties.ZIP == null) {\n                return\n            }\n            const widget = self.context.getFrame(\"/demos/VizDetailHover.ipynb\", [\n                {\n                    name: \"SelectedZip\",\n                    value: d.properties.ZIP\n                }\n            ]);\n            openHover = self.context.openHover({\n                hover: widget,\n                width: 500,\n                mode: \"tooltip\",\n                height: 400,\n                x: d3.event.clientX - (window.screen.availLeft || 0),\n                y: d3.event.clientY - (window.screen.availTop || 0)\n            });\n        })\n        .on(\"mouseleave\", (d) => {\n            if (openHover == null) {\n                return;\n            }\n            self.context.hover.closeHover(openHover)\n            openHover = null;\n        })\n        .on(\"click\", (d) => {\n            console.log(d3.event.clientX, d3.event.pageX, d3.event.screenX);\n            const widget = self.context.getFrame(\"/demos/VizDetailHover.ipynb\", [\n                {\n                    name: \"SelectedZip\",\n                    value: d.properties.ZIP\n                }\n            ]);\n            self.context.openHover({\n                hover: widget,\n                width: 500,\n                mode: d3.event.shiftKey ? \"popup\" : \"hover\",\n                height: 400,\n                // availLeft and availTop are non-standard but necessary to handle\n                // multiple monitors\n                x: d3.event.screenX - (window.screen.availLeft || 0),\n                y: d3.event.screenY - (window.screen.availTop || 0)\n            });\n        });\n\n    svg.append(\"path\")\n        .attr(\"class\", \"tract-border\")\n        .attr(\"d\", path(topojson.mesh(window.shapefile, zipcodeFeature, (a, b) => a !== b)));\n}\nthis.initialize = function() {\n    console.log(\"initialize\");\n    return fetch(\"https://dl.dropboxusercontent.com/s/2jx8op1h9npo3ek/king-county.json\")\n    .then(res => res.json())\n    .then(data => {\n        window.shapefile = JSON.parse(data.data);\n        setupChoropleth();\n    });\n}","cssText":"body {\n    background: #acf;\n    overflow: hidden;\n    padding: 0;\n    margin: 0;\n    transform-origin: 0 0;\n}\n\npath.tract {\n    fill: #ccc;\n}\n\npath.tract-border {\n    fill: none;\n    stroke: #fff;\n    stroke-width: 1px;\n}"},"functionType":"UserDefinedEvalPart","arguments":[{"name":"Data Input","defaultValue":{"typeName":"Table","value":{"rows":[{"value":{"data":[{"typeName":"Number","value":{"val":98001,"boxed":false}},{"typeName":"Number","value":{"val":280804.6906077348,"boxed":false}},{"typeName":"Number","value":{"val":362,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98002,"boxed":false}},{"typeName":"Number","value":{"val":234284.0351758794,"boxed":false}},{"typeName":"Number","value":{"val":199,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98003,"boxed":false}},{"typeName":"Number","value":{"val":294111.27857142856,"boxed":false}},{"typeName":"Number","value":{"val":280,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98004,"boxed":false}},{"typeName":"Number","value":{"val":1355927.0820189274,"boxed":false}},{"typeName":"Number","value":{"val":317,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98005,"boxed":false}},{"typeName":"Number","value":{"val":810164.875,"boxed":false}},{"typeName":"Number","value":{"val":168,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98006,"boxed":false}},{"typeName":"Number","value":{"val":859684.7791164658,"boxed":false}},{"typeName":"Number","value":{"val":498,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98007,"boxed":false}},{"typeName":"Number","value":{"val":617105.085106383,"boxed":false}},{"typeName":"Number","value":{"val":141,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98008,"boxed":false}},{"typeName":"Number","value":{"val":645507.3780918728,"boxed":false}},{"typeName":"Number","value":{"val":283,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98010,"boxed":false}},{"typeName":"Number","value":{"val":423665.99,"boxed":false}},{"typeName":"Number","value":{"val":100,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98011,"boxed":false}},{"typeName":"Number","value":{"val":490351.4666666667,"boxed":false}},{"typeName":"Number","value":{"val":195,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98014,"boxed":false}},{"typeName":"Number","value":{"val":455617.1129032258,"boxed":false}},{"typeName":"Number","value":{"val":124,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98019,"boxed":false}},{"typeName":"Number","value":{"val":424788.74736842106,"boxed":false}},{"typeName":"Number","value":{"val":190,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98022,"boxed":false}},{"typeName":"Number","value":{"val":315709.30341880344,"boxed":false}},{"typeName":"Number","value":{"val":234,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98023,"boxed":false}},{"typeName":"Number","value":{"val":286732.79158316634,"boxed":false}},{"typeName":"Number","value":{"val":499,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98024,"boxed":false}},{"typeName":"Number","value":{"val":580526.7901234567,"boxed":false}},{"typeName":"Number","value":{"val":81,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98027,"boxed":false}},{"typeName":"Number","value":{"val":616990.5922330098,"boxed":false}},{"typeName":"Number","value":{"val":412,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98028,"boxed":false}},{"typeName":"Number","value":{"val":462480.035335689,"boxed":false}},{"typeName":"Number","value":{"val":283,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98029,"boxed":false}},{"typeName":"Number","value":{"val":612653.6105919003,"boxed":false}},{"typeName":"Number","value":{"val":321,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98030,"boxed":false}},{"typeName":"Number","value":{"val":296187.98046875,"boxed":false}},{"typeName":"Number","value":{"val":256,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98031,"boxed":false}},{"typeName":"Number","value":{"val":300539.8905109489,"boxed":false}},{"typeName":"Number","value":{"val":274,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98032,"boxed":false}},{"typeName":"Number","value":{"val":251296.24,"boxed":false}},{"typeName":"Number","value":{"val":125,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98033,"boxed":false}},{"typeName":"Number","value":{"val":803719.5231481482,"boxed":false}},{"typeName":"Number","value":{"val":432,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98034,"boxed":false}},{"typeName":"Number","value":{"val":521652.8587155963,"boxed":false}},{"typeName":"Number","value":{"val":545,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98038,"boxed":false}},{"typeName":"Number","value":{"val":366867.6,"boxed":false}},{"typeName":"Number","value":{"val":590,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98039,"boxed":false}},{"typeName":"Number","value":{"val":2160606.6,"boxed":false}},{"typeName":"Number","value":{"val":50,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98040,"boxed":false}},{"typeName":"Number","value":{"val":1194230.0212765958,"boxed":false}},{"typeName":"Number","value":{"val":282,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98042,"boxed":false}},{"typeName":"Number","value":{"val":311632.10583941604,"boxed":false}},{"typeName":"Number","value":{"val":548,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98045,"boxed":false}},{"typeName":"Number","value":{"val":439471.0814479638,"boxed":false}},{"typeName":"Number","value":{"val":221,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98052,"boxed":false}},{"typeName":"Number","value":{"val":645231.456445993,"boxed":false}},{"typeName":"Number","value":{"val":574,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98053,"boxed":false}},{"typeName":"Number","value":{"val":678163.0592592593,"boxed":false}},{"typeName":"Number","value":{"val":405,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98055,"boxed":false}},{"typeName":"Number","value":{"val":304262.1082089552,"boxed":false}},{"typeName":"Number","value":{"val":268,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98056,"boxed":false}},{"typeName":"Number","value":{"val":420890.54926108377,"boxed":false}},{"typeName":"Number","value":{"val":406,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98058,"boxed":false}},{"typeName":"Number","value":{"val":353608.63516483514,"boxed":false}},{"typeName":"Number","value":{"val":455,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98059,"boxed":false}},{"typeName":"Number","value":{"val":493552.53205128206,"boxed":false}},{"typeName":"Number","value":{"val":468,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98065,"boxed":false}},{"typeName":"Number","value":{"val":527961.2032258065,"boxed":false}},{"typeName":"Number","value":{"val":310,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98070,"boxed":false}},{"typeName":"Number","value":{"val":487479.6271186441,"boxed":false}},{"typeName":"Number","value":{"val":118,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98072,"boxed":false}},{"typeName":"Number","value":{"val":569958.4652014652,"boxed":false}},{"typeName":"Number","value":{"val":273,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98074,"boxed":false}},{"typeName":"Number","value":{"val":685605.775510204,"boxed":false}},{"typeName":"Number","value":{"val":441,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98075,"boxed":false}},{"typeName":"Number","value":{"val":790576.6545961003,"boxed":false}},{"typeName":"Number","value":{"val":359,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98077,"boxed":false}},{"typeName":"Number","value":{"val":682774.8787878788,"boxed":false}},{"typeName":"Number","value":{"val":198,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98092,"boxed":false}},{"typeName":"Number","value":{"val":334921.0626780627,"boxed":false}},{"typeName":"Number","value":{"val":351,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98102,"boxed":false}},{"typeName":"Number","value":{"val":901258.2666666667,"boxed":false}},{"typeName":"Number","value":{"val":105,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98103,"boxed":false}},{"typeName":"Number","value":{"val":584919.2109634551,"boxed":false}},{"typeName":"Number","value":{"val":602,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98105,"boxed":false}},{"typeName":"Number","value":{"val":862825.2314410481,"boxed":false}},{"typeName":"Number","value":{"val":229,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98106,"boxed":false}},{"typeName":"Number","value":{"val":319581.3940298507,"boxed":false}},{"typeName":"Number","value":{"val":335,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98107,"boxed":false}},{"typeName":"Number","value":{"val":579053.4172932331,"boxed":false}},{"typeName":"Number","value":{"val":266,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98108,"boxed":false}},{"typeName":"Number","value":{"val":355678.51612903224,"boxed":false}},{"typeName":"Number","value":{"val":186,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98109,"boxed":false}},{"typeName":"Number","value":{"val":879623.6238532111,"boxed":false}},{"typeName":"Number","value":{"val":109,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98112,"boxed":false}},{"typeName":"Number","value":{"val":1095499.342007435,"boxed":false}},{"typeName":"Number","value":{"val":269,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98115,"boxed":false}},{"typeName":"Number","value":{"val":619900.5471698113,"boxed":false}},{"typeName":"Number","value":{"val":583,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98116,"boxed":false}},{"typeName":"Number","value":{"val":618634.1696969697,"boxed":false}},{"typeName":"Number","value":{"val":330,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98117,"boxed":false}},{"typeName":"Number","value":{"val":576795.007233273,"boxed":false}},{"typeName":"Number","value":{"val":553,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98118,"boxed":false}},{"typeName":"Number","value":{"val":417637.43307086616,"boxed":false}},{"typeName":"Number","value":{"val":508,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98119,"boxed":false}},{"typeName":"Number","value":{"val":849448.0163043478,"boxed":false}},{"typeName":"Number","value":{"val":184,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98122,"boxed":false}},{"typeName":"Number","value":{"val":634360.1793103449,"boxed":false}},{"typeName":"Number","value":{"val":290,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98125,"boxed":false}},{"typeName":"Number","value":{"val":469455.77073170734,"boxed":false}},{"typeName":"Number","value":{"val":410,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98126,"boxed":false}},{"typeName":"Number","value":{"val":424706.3559322034,"boxed":false}},{"typeName":"Number","value":{"val":354,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98133,"boxed":false}},{"typeName":"Number","value":{"val":386997.3967611336,"boxed":false}},{"typeName":"Number","value":{"val":494,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98136,"boxed":false}},{"typeName":"Number","value":{"val":551688.6730038023,"boxed":false}},{"typeName":"Number","value":{"val":263,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98144,"boxed":false}},{"typeName":"Number","value":{"val":594547.6501457726,"boxed":false}},{"typeName":"Number","value":{"val":343,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98146,"boxed":false}},{"typeName":"Number","value":{"val":359483.2395833333,"boxed":false}},{"typeName":"Number","value":{"val":288,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98148,"boxed":false}},{"typeName":"Number","value":{"val":284908.5964912281,"boxed":false}},{"typeName":"Number","value":{"val":57,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98155,"boxed":false}},{"typeName":"Number","value":{"val":423725.69506726455,"boxed":false}},{"typeName":"Number","value":{"val":446,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98166,"boxed":false}},{"typeName":"Number","value":{"val":464231.8385826772,"boxed":false}},{"typeName":"Number","value":{"val":254,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98168,"boxed":false}},{"typeName":"Number","value":{"val":240328.3717472119,"boxed":false}},{"typeName":"Number","value":{"val":269,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98177,"boxed":false}},{"typeName":"Number","value":{"val":676185.3921568628,"boxed":false}},{"typeName":"Number","value":{"val":255,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98178,"boxed":false}},{"typeName":"Number","value":{"val":310612.75572519086,"boxed":false}},{"typeName":"Number","value":{"val":262,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98188,"boxed":false}},{"typeName":"Number","value":{"val":289078.3455882353,"boxed":false}},{"typeName":"Number","value":{"val":136,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98198,"boxed":false}},{"typeName":"Number","value":{"val":302878.8821428571,"boxed":false}},{"typeName":"Number","value":{"val":280,"boxed":false}}],"children":[],"name":null}},{"value":{"data":[{"typeName":"Number","value":{"val":98199,"boxed":false}},{"typeName":"Number","value":{"val":791820.807570978,"boxed":false}},{"typeName":"Number","value":{"val":317,"boxed":false}}],"children":[],"name":null}}],"cols":["zip","Price","Count"],"types":["Any","Any","Any"]}},"typeAnnotation":"Table"}],"returnType":"Any"}